box: node

build:
  steps:
    - npm-install
    - script:
      name: refresh data
      code: |
          node ./scripts/generate-sessions-data.js
    - script:
      name: commit data updates
      code: |
          git config --local user.email "dddmelbourne@gmail.com"
          git config --local user.name "Wercker Deployment"
          git checkout master
          git add -A
          git commit -m "[skip ci] Refreshing site data" || true
          git push origin master
    - arjen/hugo-build@1.16.3:
      version: "0.20.7"
      disable_pygments: true

deploy:
  steps:
    - script:
      name: deploy to firebase
      code: |
          node ./node_modules/firebase-tools/bin/firebase use production
          node ./node_modules/firebase-tools/bin/firebase deploy --token $FIREBASE_TOKEN
